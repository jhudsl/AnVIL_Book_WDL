<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Write WDL | WDL Workflows</title>
  <meta name="description" content="Description about Course/Book." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Write WDL | WDL Workflows" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Description about Course/Book." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Write WDL | WDL Workflows" />
  
  <meta name="twitter:description" content="Description about Course/Book." />
  



<meta name="date" content="2023-03-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/AnVIL_style/anvil_favicon.ico" type="image/x-icon" />
<link rel="prev" href="run-workflow.html"/>
<link rel="next" href="localize-files.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>




<link rel="stylesheet" href="assets/style.css" type="text/css" />
<link rel="stylesheet" href="assets/AnVIL_style/anvil.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<a href="https://anvilproject.org/" target="_blank"><img src="assets/AnVIL_style/logo-anvil.png" style="width: 80%; padding-left: 15px; padding-top: 8px;"</a>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#skills-level"><i class="fa fa-check"></i>Skills Level</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#anvil-collection"><i class="fa fa-check"></i>AnVIL Collection</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="run-workflow.html"><a href="run-workflow.html"><i class="fa fa-check"></i><b>2</b> Run Workflow</a></li>
<li class="chapter" data-level="3" data-path="write-wdl.html"><a href="write-wdl.html"><i class="fa fa-check"></i><b>3</b> Write WDL</a>
<ul>
<li class="chapter" data-level="3.1" data-path="write-wdl.html"><a href="write-wdl.html#access-broad-methods-repository"><i class="fa fa-check"></i><b>3.1</b> Access Broad Methods Repository</a></li>
<li class="chapter" data-level="3.2" data-path="write-wdl.html"><a href="write-wdl.html#write-wdl101-training-example"><i class="fa fa-check"></i><b>3.2</b> Write WDL101 Training Example</a></li>
<li class="chapter" data-level="3.3" data-path="write-wdl.html"><a href="write-wdl.html#export-to-anvil-and-run"><i class="fa fa-check"></i><b>3.3</b> Export to AnVIL and run</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="localize-files.html"><a href="localize-files.html"><i class="fa fa-check"></i><b>4</b> Localize Files</a></li>
<li class="chapter" data-level="5" data-path="customize-docker.html"><a href="customize-docker.html"><i class="fa fa-check"></i><b>5</b> Customize Docker</a></li>
<li class="chapter" data-level="6" data-path="join-discourse.html"><a href="join-discourse.html"><i class="fa fa-check"></i><b>6</b> Join Discourse</a></li>
<li class="chapter" data-level="" data-path="about-the-authors.html"><a href="about-the-authors.html"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<p style="text-align:center;"> <a href="https://github.com/jhudsl/OTTR_Template" target="blank" > This content was published with</a> <a href="https://bookdown.org/" target="blank"> bookdown by: </a> </p>
<p style="text-align:center;"> <a href="https://hutchdatascience.org/"> The Fred Hutch Data Science Lab </a></p>
<a href="https://hutchdatascience.org/" target="_blank"><img src="https://raw.githubusercontent.com/jhudsl/OTTR_Template/main/style-sets/fhdasl/copy_to_assets/big-dasl-stacked.png" style="width: 80%; padding-left: 34px; padding-top: 8px;"</a>
<p style="text-align:center; font-size: 12px;"> <a href="https://github.com/rstudio4edu/rstudio4edu-book/"> Style adapted from: rstudio4edu-book </a> <a href ="https://creativecommons.org/licenses/by/2.0/"> (CC-BY 2.0) </a></p>
<p style="padding-left: 40px;"><div class="trapezoid" style = "padding-left: 40px;"><span>  <a href="https://forms.gle/AK12iVXTjsB7yCUUA"> Click here to provide feedback</a> <img src="assets/itcr_arrow.png" style=" width: 10%" ></span></div></p>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">WDL Workflows</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<head>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=10.0,initial-scale=1.0">
  <!--script src="https://kit.fontawesome.com/6a26f47516.js"></script-->
  <!--<script src="assets/hideOutput.js"></script>-->
</head>
        


<div class="hero-image-container"> 
  <img class= "hero-image" src="assets/AnVIL_style/dasl_thin_main_image.png">
</div>
<div id="write-wdl" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Write WDL</h1>
<p>Now that you’ve successfully run a Workflow on AnVIL, this tutorial demonstrates how you can create and edit a WDL using the <a href="https://portal.firecloud.org/?return=anvil#methods">Broad Methods Repository</a>.
While this “legacy” Methods repository does not have many of the features present in the open-source <a href="https://anvilproject.org/overview#platform-interoperability">Dockstore</a> platform, it does offer a convenient web-based editor for demonstration purposes.
This material is adapted from the <a href="https://support.terra.bio/hc/en-us/articles/8693717360411">WDL 101 Workshop</a>;
you can read about other ways the Broad Methods Repository can be used in <a href="https://support.terra.bio/hc/en-us/articles/360031366091">this Terra Support article</a>.</p>
<p><strong>Learning Objectives</strong></p>
<ol style="list-style-type: decimal">
<li>Access Broad Methods Repository</li>
<li>Write WDL101 Training Example</li>
<li>Export to Terra and run</li>
</ol>
<div id="access-broad-methods-repository" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Access Broad Methods Repository</h2>
<p>Let’s start by navigating to the WDL-puzzles workspace that we previously cloned. Please double check your workspace name to ensure that this is the copy that you made rather than the original as you will not be able to use the original workspace to create a new WDL or run a workflow.</p>
<pre><code>## Warning: replacing previous import &#39;ellipsis::check_dots_unnamed&#39; by
## &#39;rlang::check_dots_unnamed&#39; when loading &#39;tibble&#39;</code></pre>
<pre><code>## Warning: replacing previous import &#39;ellipsis::check_dots_used&#39; by
## &#39;rlang::check_dots_used&#39; when loading &#39;tibble&#39;</code></pre>
<pre><code>## Warning: replacing previous import &#39;ellipsis::check_dots_empty&#39; by
## &#39;rlang::check_dots_empty&#39; when loading &#39;tibble&#39;</code></pre>
<pre><code>## Warning: replacing previous import &#39;ellipsis::check_dots_unnamed&#39; by
## &#39;rlang::check_dots_unnamed&#39; when loading &#39;pillar&#39;</code></pre>
<pre><code>## Warning: replacing previous import &#39;ellipsis::check_dots_used&#39; by
## &#39;rlang::check_dots_used&#39; when loading &#39;pillar&#39;</code></pre>
<pre><code>## Warning: replacing previous import &#39;ellipsis::check_dots_empty&#39; by
## &#39;rlang::check_dots_empty&#39; when loading &#39;pillar&#39;</code></pre>
<p><img src="03-write-wdl_files/figure-html/1o2XnuMbqWVLf4XrsXolIQ7ulfnMlpJlrUxN0Y8aLIVQ_g1397c25e58c_0_185.png" width="480" /></p>
<p>Once you’ve double checked that you are in a workspace that you can modify and compute, click on the Workflows tab.</p>
<p><img src="03-write-wdl_files/figure-html/1o2XnuMbqWVLf4XrsXolIQ7ulfnMlpJlrUxN0Y8aLIVQ_g139bf26eaed_0_27.png" width="480" /></p>
<p>Click on the Find a Workflow card.</p>
<p><img src="03-write-wdl_files/figure-html/1o2XnuMbqWVLf4XrsXolIQ7ulfnMlpJlrUxN0Y8aLIVQ_g139bf26eaed_0_1.png" width="480" /></p>
<p>Select the Broad Methods Repository option.</p>
<p><img src="03-write-wdl_files/figure-html/1o2XnuMbqWVLf4XrsXolIQ7ulfnMlpJlrUxN0Y8aLIVQ_g139bf26eaed_0_6.png" width="480" /></p>
<p>Click Create New Method.</p>
<p><img src="03-write-wdl_files/figure-html/1o2XnuMbqWVLf4XrsXolIQ7ulfnMlpJlrUxN0Y8aLIVQ_g139bf26eaed_0_11.png" width="480" /></p>
<p>Add a namespace to the first text box to organize your WDLs.
Your username (prepended with your lab name) is a reasonable namespace as this must be unique across all of Broad Methods Repository.
Afterwards, add a name such as <code>wdl101</code> to name your WDL.</p>
<p><img src="03-write-wdl_files/figure-html/1o2XnuMbqWVLf4XrsXolIQ7ulfnMlpJlrUxN0Y8aLIVQ_g139bf26eaed_0_16.png" width="480" /></p>
</div>
<div id="write-wdl101-training-example" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Write WDL101 Training Example</h2>
<p>Let’s now create a basic WDL!
This simple “Hello, World!” style workflow will take as input a string, call a single task, and save the output of that task to your workspace bucket.
The task that is called will run the <a href="https://swcarpentry.github.io/shell-novice/01-intro/index.html">Bash</a> <code>echo</code> command to print the input string to <code>stdout</code>.</p>
<p>First note that we are using the <a href="https://github.com/openwdl/wdl/tree/main/versions">WDL 1.0 spec</a>.</p>
<pre><code>version 1.0</code></pre>
<p>Let’s add a workflow <code>HelloInput</code> that calls a single task <code>WriteGreeting</code>.</p>
<pre><code>version 1.0
workflow HelloInput {
}

task WriteGreeting{
}</code></pre>
<p>To create the task, we will define <code>input</code>, <code>command</code>, <code>output</code>, and <code>runtime</code> blocks.
Note that the command block is defined as a “<a href="https://en.wikipedia.org/wiki/Here_document">here doc</a>” and prints the input string to <code>stdout</code>.</p>
<pre><code>version 1.0
workflow HelloInput {
}

task WriteGreeting {
  input {
    String name_for_greeting
  }
  command &lt;&lt;&lt;
    echo &#39;hello ~{name_for_greeting}!&#39;
  &gt;&gt;&gt;
  output {
    File Greeting_output = stdout()
  }
  runtime {
    docker: &#39;ubuntu:latest&#39;
  }
}</code></pre>
<p>Putting it all together, we now create the workflow by defining an input string stored in a variable named <code>name_input</code>, calling the task by passing <code>name_input</code> to <code>name_for_greeting</code>, and storing what is returned by the task in a File labeled <code>final_output</code>.</p>
<pre><code>version 1.0
workflow HelloInput {
  input {
    String name_input
  }
  call WriteGreeting {
    input: 
      name_for_greeting = name_input
  }
  output {
    File final_output = WriteGreeting.Greeting_output
  }
}

task WriteGreeting {
  input {
    String name_for_greeting
  }
  command &lt;&lt;&lt;
    echo &#39;hello ~{name_for_greeting}!&#39;
  &gt;&gt;&gt;
  output {
    File Greeting_output = stdout()
  }
  runtime {
    docker: &#39;ubuntu:latest&#39;
  }
}</code></pre>
</div>
<div id="export-to-anvil-and-run" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Export to AnVIL and run</h2>
<p>Once your WDL is complete, click on Upload.</p>
<p><img src="03-write-wdl_files/figure-html/1o2XnuMbqWVLf4XrsXolIQ7ulfnMlpJlrUxN0Y8aLIVQ_g139bf26eaed_0_40.png" width="480" /></p>
<p>Now click on Export to Workspace.</p>
<p><img src="03-write-wdl_files/figure-html/1o2XnuMbqWVLf4XrsXolIQ7ulfnMlpJlrUxN0Y8aLIVQ_g139bf26eaed_0_45.png" width="480" /></p>
<p>Select Use Blank Configuration.</p>
<p><img src="03-write-wdl_files/figure-html/1o2XnuMbqWVLf4XrsXolIQ7ulfnMlpJlrUxN0Y8aLIVQ_g139bf26eaed_0_50.png" width="480" /></p>
<p>Select a Destination Workspace such as your clone of WDL-puzzles. Afterwards, click Export to Workspace.</p>
<p><img src="03-write-wdl_files/figure-html/1o2XnuMbqWVLf4XrsXolIQ7ulfnMlpJlrUxN0Y8aLIVQ_g139bf26eaed_0_55.png" width="480" /></p>
<p>Lastly, configure your Workflow as your did previously (e.g. inputs defined by file paths, name in double quotes), click Save, and then click Run Analysis.</p>
<p><img src="03-write-wdl_files/figure-html/1o2XnuMbqWVLf4XrsXolIQ7ulfnMlpJlrUxN0Y8aLIVQ_g139bf26eaed_0_60.png" width="480" /></p>
<p>Voila! Here’s what you hopefully see after successfully running your WDL101 Training Example !</p>
<p><img src="03-write-wdl_files/figure-html/1o2XnuMbqWVLf4XrsXolIQ7ulfnMlpJlrUxN0Y8aLIVQ_g139bf26eaed_0_65.png" width="480" /></p>

</div>
</div>
<hr>
<center> 
  <div class="footer">
      All illustrations <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY. </a>
      <br>
      All other materials <a href= "https://creativecommons.org/licenses/by/4.0/"> CC-BY </a> unless noted otherwise.
  </div>
</center>
            </section>

          </div>
        </div>
      </div>
<a href="run-workflow.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="localize-files.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
